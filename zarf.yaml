kind: ZarfPackageConfig
metadata:
  name: rook-ceph
  description: "UDS Package Rook Ceph"
  version: "0.0.1"
  architecture: amd64

variables:
  - name: DEVICE_FILTER
    description: "Regular expression matching all devices to use for Ceph storage, example '^sd.'"
    default: ""
    prompt: false

components:
  - name: rook-ceph-operator
    required: true
    charts:
      # renovate: datasource=helm
      - name: rook-ceph
        url: https://charts.rook.io/release
        version: v1.12.2
        namespace: rook-ceph
        valuesFiles:
          - values/operator-values.yaml
    images:
      - registry1.dso.mil/ironbank/rook/ceph:v1.12.2
  - name: rook-ceph-cluster
    required: true
    actions:
      onDeploy:
        after:
          - cmd: "./zarf tools wait-for cephcluster -n rook-ceph rook-ceph '{.status.phase}'=Ready --timeout=10m"
            description: "Waiting for ceph cluster to be ready"
            mute: true
          - cmd: "./zarf tools wait-for cephblockpool -n rook-ceph ceph-blockpool '{.status.phase}'=Ready --timeout=10m"
            description: "Waiting for ceph blockpool to be ready"
            mute: true
          - cmd: "./zarf tools wait-for cephfilesystem -n rook-ceph ceph-filesystem '{.status.phase}'=Ready --timeout=10m"
            description: "Waiting for ceph filesystem to be ready"
            mute: true
          - cmd: "./zarf tools wait-for cephobjectstore -n rook-ceph ceph-objectstore '{.status.phase}'=Ready --timeout=10m"
            description: "Waiting for ceph objectstore to be ready"
            mute: true
    charts:
      - name: rook-ceph-cluster
        version: v1.12.2
        namespace: rook-ceph
        url: https://charts.rook.io/release
        valuesFiles:
          - values/cluster-values.yaml
    images:
      - registry1.dso.mil/ironbank/rook/ceph:v1.12.2
      - registry1.dso.mil/ironbank/opensource/ceph/ceph:v17.2.6
      - registry1.dso.mil/ironbank/opensource/ceph/ceph-csi:v3.9.0
      - registry1.dso.mil/ironbank/opensource/kubernetes-sigs/sig-storage/csi-node-driver-registrar:v2.8.0
      - registry1.dso.mil/ironbank/opensource/kubernetes-sigs/sig-storage/csi-provisioner:v3.4.1
      - registry1.dso.mil/ironbank/opensource/kubernetes-sigs/sig-storage/csi-snapshotter:v6.2.1
      - registry1.dso.mil/ironbank/opensource/kubernetes-sigs/sig-storage/csi-attacher:v4.2.0
      - registry1.dso.mil/ironbank/opensource/kubernetes-sigs/sig-storage/csi-resizer:v1.5.0
